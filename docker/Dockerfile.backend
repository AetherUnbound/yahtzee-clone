FROM node:20-alpine

# Install wget for healthcheck
RUN apk add --no-cache wget

WORKDIR /app

# Copy server package files
COPY server/package*.json ./

# Install production dependencies only
RUN npm ci --omit=dev

# Copy server source code
COPY server/ ./

# Create directory for database with proper permissions
RUN mkdir -p /app/data && chown -R node:node /app

# Use non-root user
USER node

# Expose the server port
EXPOSE 3001

# Start the server
CMD ["node", "server.js"]
